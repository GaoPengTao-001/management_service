<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.org.management.mapper.OrganizationMapper">
    <!--大区列表-->
    <select id="regionList" resultType="java.util.Map">
      SELECT DISTINCT
            A .region_id "region_id",
            A .region_nm "region_nm"
        FROM
            td_dds_fmc A
        ORDER BY
            A .region_nm
    </select>

    <!--小区列表-->
    <select id="fmcList" resultType="java.util.Map">
        SELECT
        A .region_id "region_id",
        A .region_nm "region_nm",
        A .fmc_id "fmc_id",
        A .fmc_nm "fmc_nm"
        FROM
        td_dds_fmc A
        <if test="'' != query.regionId and null != query.regionId">
            AND A.region_id =#{ query.regionId }
        </if>
        ORDER BY
        A .region_nm,
        A .fmc_nm
    </select>

    <!--集团列表，和小区互斥-->
    <select id="groupList" resultType="java.util.Map">
        SELECT DISTINCT
          t.region_id,
          'GROUP:' || t.asc_grp_id asc_grp_id,
          t.asc_grp_nm
        FROM
          td_dds_asc t
        <if test="'' != query.regionId and null != query.regionId">
            AND t.region_id =#{ query.regionId }
        </if>
        ORDER BY
          t.region_id,
          asc_grp_id
    </select>

    <!--省份列表-->
    <select id="provList" resultType="java.util.Map">
        SELECT distinct
          a.prov_id,
          decode(
              a.prov_cn_nm,
              NULL,
              '其它',
              a.prov_cn_nm
            ) prov_cn_nm
        FROM
          td_dds_city a
        ORDER BY
          a.prov_id
    </select>

    <!--城市列表-->
    <select id="cityList" resultType="java.util.Map">
        SELECT
          a.city_id,
          a.city_cn_nm
        FROM
          td_dds_city a
        <if test="'' != query.provId and null != query.provId">
            AND a.prov_id =#{ query.provId }
        </if>
        ORDER BY
          a.city_id
    </select>

    <!--经销商列表-->
    <select id="ascList" resultType="java.util.Map">
        <![CDATA[
            SELECT
                G .asc_id
            VALUE
                ,
                G .asc_cd || '_' || G .asc_nm label
            FROM
                TD_DDS_ASC G
            WHERE
                1 = 1
            AND G .asc_st <> 3
       ]]>
        <if test="'' != query.regionId and null != query.regionId">
            AND G .region_id =#{ query.regionId }
        </if>
        <if test="'' != query.fmcId and null != query.fmcId">
            AND G .FMC_ID =#{ query.fmcId }
        </if>
        <if test="'' != query.ascGrpId and null != query.ascGrpId">
            AND G .asc_grp_id =#{ query.ascGrpId }
        </if>
        <if test="'' != query.provId and null != query.provId">
            AND G .prov_id =#{ query.provId }
        </if>
        <if test="'' != query.cityId and null != query.cityId">
            AND G .city_id =#{ query.cityId }
        </if>
        ORDER BY
        G .asc_cd
    </select>

    <select id="selectOutputValue" resultType="com.org.management.entity.OutputValue">
        SELECT
            id AS id,
            value_date AS valueDate,
            busid AS busid,
            totail AS totail,
            totail_last AS totailLast,
            totail_current AS totailCurrent,
            claim AS claim,
            claim_last AS claimLast,
            claim_current AS claimCurrent,
            guarantee AS guarantee,
            guarantee_last AS guaranteeLast,
            guarantee_current AS guaranteeCurrent,
            no_guarantee AS noGuarantee,
            no_guarantee_last AS noGuaranteeLast,
            no_guarantee_current AS noGuaranteeCurrent,
            no_claim AS noClaim,
            no_claim_last AS noClaimLast,
            no_claim_current AS noClaimCurrent,
            maintain AS maintain,
            maintain_last AS maintainLast,
            maintain_current AS maintainCurrent,
            REPAIR AS REPAIR,
            repair_last AS repairLast,
            repair_current AS repairCurrent,
            accident AS accident,
            accident_last AS accidentLast,
            accident_current AS accidentCurrent,
            sale AS sale,
            sale_last AS saleLast,
            sale_current AS saleCurrent,
            rework AS rework,
            rework_last AS reworkLast,
            rework_current AS reworkCurrent
        FROM
            T_OUTPUT_VALUE
        where busid = #{query.busId} and value_date = #{query.dateValue}
    </select>
    <select id="selectRegionId" resultType="com.org.management.entity.OrgInfo">
        SELECT DISTINCT
              REGION_ID id,
              REGION_NM name
            FROM
              T_REGION
            ORDER BY
              REGION_NM ASC
    </select>
    <select id="selectFmcIdByRegionId" resultType="com.org.management.entity.OrgInfo">
        SELECT DISTINCT
                    FMC_ID id,
                    FMC_NM name
                FROM
                    T_REGION
                WHERE
                    REGION_ID = #{id}
                ORDER BY
                    FMC_NM ASC
    </select>
    <select id="selectAscCdByFmcId" resultType="com.org.management.entity.OrgInfo">
        SELECT DISTINCT
              ASC_CD id,
              ASC_NM name
            FROM
              T_REGION
            where FMC_ID = #{id}
            ORDER BY
              ASC_NM ASC
    </select>
    <select id="selectAscCdDetailByAsc" resultType="com.org.management.entity.OrgInfo">
        SELECT DISTINCT
              ASC_CD id,
              ASC_NM name
            FROM
              T_REGION
            where ASC_CD = #{id}
            ORDER BY
              ASC_NM ASC
    </select>
    <select id="selectOutputValueDetail" resultType="com.org.management.entity.OutputValue">
        SELECT
        id AS id,
        value_date AS valueDate,
        busid AS busid,
        totail AS totail,
        totail_last AS totailLast,
        totail_current AS totailCurrent,
        claim AS claim,
        claim_last AS claimLast,
        claim_current AS claimCurrent,
        guarantee AS guarantee,
        guarantee_last AS guaranteeLast,
        guarantee_current AS guaranteeCurrent,
        no_guarantee AS noGuarantee,
        no_guarantee_last AS noGuaranteeLast,
        no_guarantee_current AS noGuaranteeCurrent,
        no_claim AS noClaim,
        no_claim_last AS noClaimLast,
        no_claim_current AS noClaimCurrent,
        maintain AS maintain,
        maintain_last AS maintainLast,
        maintain_current AS maintainCurrent,
        REPAIR AS REPAIR,
        repair_last AS repairLast,
        repair_current AS repairCurrent,
        accident AS accident,
        accident_last AS accidentLast,
        accident_current AS accidentCurrent,
        sale AS sale,
        sale_last AS saleLast,
        sale_current AS saleCurrent,
        rework AS rework,
        rework_last AS reworkLast,
        rework_current AS reworkCurrent
        FROM
        T_OUTPUT_VALUE
        where busid in
        <foreach item="item" index="index" collection="ids"
                 open="(" separator="," close=")">
            #{item.id}
        </foreach>
        and value_date = #{dateValue}
    </select>
</mapper>